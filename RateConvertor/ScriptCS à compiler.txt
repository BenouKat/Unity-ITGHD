using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;
using System.IO;

namespace rateConvertor
{
    class Program
    {
        //Args :
        //0 : number rate
        //1 : Application Path
        //2 : System (32 or 64)
        //3 : path to song
        static void Main(string[] args)
        {
	    var rate = args[0];
	    var appPath = args[1].Replace("%SPACE%", " ");
	    var bitSys = args[2];
	    var songPath = args[3].Replace("%SPACE%", " ");

            ProcessStartInfo oggToWavProcess = new ProcessStartInfo(appPath + "\\RateConvertor\\x" + bitSys + "\\ffmpeg.exe");
            oggToWavProcess.Arguments = "-i " + songPath + " " + Path.GetDirectoryName(songPath) + "\\TempWav.wav";
            oggToWavProcess.WindowStyle = ProcessWindowStyle.Hidden;

            Process myProcess = Process.Start(oggToWavProcess);
            myProcess.WaitForExit();
            myProcess.Close();



            ProcessStartInfo wavTransform = new ProcessStartInfo(appPath + "\\RateConvertor\\soundstretch.exe");
            wavTransform.Arguments = Path.GetDirectoryName(songPath) + "\\TempWav.wav" + " " + Path.GetDirectoryName(songPath) + "\\TempWavTransformed.wav" +
                " " + "-rate=" + rate;
            wavTransform.WindowStyle = ProcessWindowStyle.Hidden;

            myProcess = Process.Start(wavTransform);
            myProcess.WaitForExit();
            myProcess.Close();

            File.Move(songPath, Path.GetDirectoryName(songPath) + "\\OriginalSong.ogg");

            ProcessStartInfo wavToOggProcess = new ProcessStartInfo(appPath + "\\RateConvertor\\x" + bitSys + "\\ffmpeg.exe");
            wavToOggProcess.Arguments = "-i " + Path.GetDirectoryName(songPath) + "\\TempWavTransformed.wav" + " -acodec libvorbis " + songPath;
            wavToOggProcess.WindowStyle = ProcessWindowStyle.Hidden;

            myProcess = Process.Start(wavToOggProcess);
            myProcess.WaitForExit();
            myProcess.Close();

            File.Delete(Path.GetDirectoryName(songPath) + "\\TempWav.wav");
            File.Delete(Path.GetDirectoryName(songPath) + "\\TempWavTransformed.wav");
        }
    }
}
